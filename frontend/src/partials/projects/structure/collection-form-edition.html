<ol class="breadcrumb">
	<li ng-if="userCtx.type == 'user'"><a ui-sref="main.projects" translate="shared.projects"></a></li>
	<li class="active" title="{{masterProject.country}}" ng-bind="masterProject.country|maxLength:20"></li>
	<li class="active" title="{{masterProject.name}}" ng-bind="masterProject.name|maxLength:50"></li>
	<li><a ui-sref="main.project.structure.collection_form_list" translate="project.collection_form_list"></a></li>
	<li class="active">{{form.name|maxLength:50}}</li>
</ol>


<div class="pull-right">
	<a ng-click="deleteForm()" class="btn btn-xxs btn-danger">
		<i class="fa fa-times"></i>
		<span translate="project.delete_form"></span>
	</a>
</div>


<form class="form-horizontal" role="form" name="forms.current" novalidate>
	<legend translate="project.collection_form_planning"></legend>

	<!-- [name] -->
	<div class="form-group" show-errors>
		<label for="input-name" class="col-sm-2 control-label" translate="shared.name"></label>
		<div class="col-sm-10">

			<input type="text"
				   class="form-control"
				   id="input-name"
				   name="name"
				   ng-model="form.name"
				   placeholder="{{'project.form_name_ph'|translate}}"
				   required />

			<span class="help-block">
				<i class="fa fa-info-circle"></i>
				{{'project.collection_edit_help_name'|translate}}
			</span>
			<!-- <p class="help-block" ng-if="forms.current.name.$error.required" translate="form.mandatory"></p> -->
		</div>
	</div>
	<!-- [/name] -->

	<!-- [collection sites] -->
	<div class="form-group">
		<label for="collect-input" class="col-sm-2 control-label" translate="project.collection_site_list"></label>
		<div class="col-sm-10">
			<element-filter ng-model="form.entities" elements="editableProject.entities" groups="editableProject.groups"></element-filter>

			<span class="help-block">
				<i class="fa fa-info-circle"></i>
				{{'project.collection_edit_help_sites'|translate}}
			</span>
		</div>
	</div>
	<!-- [/collection sites] -->

	<!-- [Periodicity] -->
	<div class="form-group">
		<label for="periodicity-input" class="col-sm-2 control-label" translate="project.periodicity"></label>
		<div class="col-sm-10">
			<select class="form-control" name="periodicity" id="periodicity-input" ng-model="form.periodicity">
				<option value="day" translate="project.periodicities.day"></option>
				<option value="month_week_sat" translate="project.periodicities.month_week_sat"></option>
				<option value="month_week_sun" translate="project.periodicities.month_week_sun"></option>
				<option value="month_week_mon" translate="project.periodicities.month_week_mon"></option>
				<option value="week_sat" translate="project.periodicities.week_sat"></option>
				<option value="week_sun" translate="project.periodicities.week_sun"></option>
				<option value="week_mon" translate="project.periodicities.week_mon"></option>
				<option value="month" translate="project.periodicities.month"></option>
				<option value="quarter" translate="project.periodicities.quarter"></option>
				<option value="semester" translate="project.periodicities.semester"></option>
				<option value="year" translate="project.periodicities.year"></option>
				<option value="free" translate="project.periodicities.free"></option>
			</select>

			<span class="help-block">
				<i class="fa fa-info-circle"></i>
				{{'project.collection_edit_help_periodicity'|translate}}
			</span>
		</div>
	</div>
	<!-- [/Periodicity] -->

	<!-- [Specific dates] -->
	<div class="form-group" ng-if="form.periodicity !== 'free'">
		<label for="periodicity" class="col-sm-2 control-label" translate="project.specific_start"></label>
		<div class="col-sm-10">
			<optional-date ng-model="form.start" default="editableProject.start" message="project.same_as_start"></optional-date>

			<span class="help-block">
				<i class="fa fa-info-circle"></i>
				{{'project.collection_edit_help_start'|translate}}
			</span>
		</div>
	</div>

	<div class="form-group" ng-if="form.periodicity !== 'free'">
		<label for="periodicity" class="col-sm-2 control-label" translate="project.specific_end"></label>
		<div class="col-sm-10">
			<optional-date ng-model="form.end" default="editableProject.end" message="project.same_as_end"></optional-date>

			<span class="help-block">
				<i class="fa fa-info-circle"></i>
				{{'project.collection_edit_help_end'|translate}}
			</span>
		</div>
	</div>
	<!-- [/Specific dates] -->

	<legend translate="project.collection_form_structure"></legend>

	<!-- [Variables] -->
	<div ng-if="form.elements.length === 0" translate="project.no_variable"></div>

	<div ng-sortable="{handle: '.variable-handle'}">

		<div class="panel panel-default indicator-panel" ng-repeat="variable in form.elements">
			<div class="panel-heading" title="{{variable.name}}">
				<i class="fa fa-arrows fa-fw variable-handle"></i>
				{{variable.name|maxLength:90}}
			</div>
			<div class="panel-body" ng-if="variable.partitions.length !== 0">
				Désagrégé par
				<ul>
					<li ng-repeat="partition in variable.partitions"
						title="{{partition.elements|pluck:'name'|join:', '}}">
						{{partition.name}}
					</li>
				</ul>

				<a ui-sref="main.project.structure.variable_edition({formId: form.id, variableId: variable.id})"
					class="btn btn-primary"
					disable-if="projectChanged">Éditer</a>

			</div>
		</div>
	</div>
	<!-- [/Variables] -->

	<a class="btn btn-default" ng-click="newVariable()" disable-if="projectChanged">
		<i class="fa fa-plus"></i>
		<span translate="project.add_variable"></span>
	</a>

</form>